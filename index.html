<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>나의 가계부</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body { font-family: sans-serif; transition: background 0.5s; }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    .header { text-align: center; margin-bottom: 20px; }
    .season-info { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 20px; }
    .season-info img { width: 50px; height: 50px; }
    #seasonFoods span { background-color: rgba(255,255,255,0.6); padding: 5px 10px; border-radius: 15px; margin: 0 4px; font-size: 0.9em; }
    .calendar-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
    .calendar-header, .calendar-day { padding: 10px; text-align: center; border-radius: 5px; }
    .calendar-header { background-color: #f0f0f0; font-weight: bold; }
    .calendar-day { background-color: #fff; cursor: pointer; }
    .calendar-day.empty { background-color: transparent; cursor: default; }
    .calendar-day:hover { background-color: #e0e0e0; }
    .calendar-day.today { border: 2px solid #42a5f5; font-weight: bold; }
    .calendar-day.has-data { color: #d32f2f; }
    #entryBox { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 100; width: 90%; max-width: 500px; }
    #entryForm { display: flex; flex-direction: column; gap: 10px; }
    .summary-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .summary-table th, .summary-table td { border: 1px solid #ddd; padding: 8px; text-align: right; }
    .summary-table th { background-color: #f2f2f2; text-align: center; }
    .charts-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-top: 20px; }
    .chart-area { text-align: center; }
  </style>
</head>
<body>

  <div class="container">
    <header class="header">
      <div class="season-info">
        <img id="seasonImg" src="" alt="season-icon">
        <div>
          <h2 id="seasonText"></h2>
          <div id="seasonFoods"></div>
        </div>
      </div>
      <div class="calendar-controls">
        <button id="prevMonth">◀ 이전 달</button>
        <h1 id="monthTitle"></h1>
        <button id="nextMonth">다음 달 ▶</button>
      </div>
    </header>
    
    <main>
      <div id="calendar"></div>
      <hr style="margin: 30px 0;">
      <div id="monthlySummary"></div>
      <hr style="margin: 30px 0;">
      <div id="annualSummary"></div>
      <hr style="margin: 30px 0;">
      <div class="charts-container" id="charts"></div>
    </main>
  </div>

  <div id="entryBox">
    <h3 id="selectedDate"></h3>
    <form id="entryForm">
      <select id="mainCategory">
        <option value="소비">소비</option>
        <option value="투자">투자</option>
        <option value="수입">수입</option>
      </select>
      <select id="subCategory"></select>
      <input type="number" id="amount" placeholder="금액" required>
      <input type="text" id="note" placeholder="메모">
      <button type="submit">저장</button>
    </form>
    <table class="summary-table" style="margin-top: 20px;">
      <thead>
        <tr><th>대분류</th><th>소분류</th><th>금액</th><th>메모</th><th>삭제</th></tr>
      </thead>
      <tbody id="dataTable"></tbody>
    </table>
    <button id="closeEntry" style="margin-top: 15px;">닫기</button>
  </div>

  <script>
    // 1. 계절/제철 식품/이미지/파스텔톤
    const SEASON_MAP = [
      {
        name: "봄", months: [3,4,5], bg: "#ffeef7",
        img: "https://openmoji.org/data/color/svg/1F353.svg", 
        foods: ["딸기🍓", "두릅", "쑥", "달래", "미나리"]
      },
      {
        name: "여름", months: [6,7,8], bg: "#e3faff",
        img: "https://openmoji.org/data/color/svg/1F349.svg",
        foods: ["수박🍉", "참외", "옥수수🌽", "오이🥒"]
      },
      {
        name: "가을", months: [9,10,11], bg: "#fff7e3",
        img: "https://openmoji.org/data/color/svg/1F34E.svg",
        foods: ["밤🌰", "감", "사과🍎", "고구마", "버섯"]
      },
      {
        name: "겨울", months: [12,1,2], bg: "#eaf3ff",
        img: "https://openmoji.org/data/color/svg/1F34A.svg",
        foods: ["귤🍊", "배추", "무", "대파", "방어🐟"]
      }
    ];
    function getSeason(month) {
      return SEASON_MAP.find(season => season.months.includes(month));
    }
    function updateSeasonUI(month) {
      const season = getSeason(month);
      document.body.style.background = season.bg;
      document.getElementById('seasonImg').src = season.img;
      document.getElementById('seasonText').textContent = `${season.name}의 제철`;
      document.getElementById('seasonFoods').innerHTML =
        season.foods.map(f => `<span>${f}</span>`).join('');
    }

    // 2. 가계부/달력 기본
    const subCategories = {
      '소비': ['식비', '교통비', '고정지출', '공과금', '거주비용', '문화비', '자기개발비', '기타(소비)'],
      '투자': ['적금', '보험', '주식', '가상화폐', '수집품', '기타(투자)'],
      '수입': ['월급', '이자수입', '배당수입', '기타수입']
    };
    const today = new Date();
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth(); // 0-indexed
    let allData = {}; // {'YYYY-MM-DD': [{main,sub,amount,note}]}
    let initialAsset = 0;

    function renderCalendar(year, month) {
      updateSeasonUI(month+1);
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';
      document.getElementById('monthTitle').textContent = `${year}년 ${month+1}월`;
      const weekDays = ['일','월','화','수','목','금','토'];
      for(let d of weekDays) {
        let hd = document.createElement('div');
        hd.className = 'calendar-header';
        hd.textContent = d;
        calendar.appendChild(hd);
      }
      let firstDay = new Date(year, month, 1).getDay();
      let lastDate = new Date(year, month+
