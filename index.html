<script>
Â  // 1. ê³„ì ˆ/ì œì²  ì‹í’ˆ/ì´ë¯¸ì§€/íŒŒìŠ¤í…”í†¤
Â  const SEASON_MAP = [
Â  Â  {
Â  Â  Â  name: "ë´„",Â  Â // 3~5ì›”
Â  Â  Â  months: [3,4,5],
Â  Â  Â  bg: "#ffeef7",
Â  Â  Â  img: "https://openmoji.org/data/color/svg/1F353.svg", // ë”¸ê¸°
Â  Â  Â  foods: ["ë”¸ê¸°ğŸ“", "ë‘ë¦…", "ì‘¥", "ë‹¬ë˜", "ë¯¸ë‚˜ë¦¬"]
Â  Â  },
Â  Â  {
Â  Â  Â  name: "ì—¬ë¦„", // 6~8ì›”
Â  Â  Â  months: [6,7,8],
Â  Â  Â  bg: "#e3faff",
Â  Â  Â  img: "https://openmoji.org/data/color/svg/1F349.svg", // ìˆ˜ë°•
Â  Â  Â  foods: ["ìˆ˜ë°•ğŸ‰", "ì°¸ì™¸", "ì˜¥ìˆ˜ìˆ˜ğŸŒ½", "ì˜¤ì´ğŸ¥’"]
Â  Â  },
Â  Â  {
Â  Â  Â  name: "ê°€ì„", // 9~11ì›”
Â  Â  Â  months: [9,10,11],
Â  Â  Â  bg: "#fff7e3",
Â  Â  Â  img: "https://openmoji.org/data/color/svg/1F34E.svg", // ì‚¬ê³¼
Â  Â  Â  foods: ["ë°¤ğŸŒ°", "ê°", "ì‚¬ê³¼ğŸ", "ê³ êµ¬ë§ˆ", "ë²„ì„¯"]
Â  Â  },
Â  Â  {
Â  Â  Â  name: "ê²¨ìš¸", // 12,1,2ì›”
Â  Â  Â  months: [12,1,2],
Â  Â  Â  bg: "#eaf3ff",
Â  Â  Â  img: "https://openmoji.org/data/color/svg/1F34A.svg", // ê·¤
Â  Â  Â  foods: ["ê·¤ğŸŠ", "ë°°ì¶”", "ë¬´", "ëŒ€íŒŒ", "ë°©ì–´ğŸŸ"]
Â  Â  }
Â  ];
Â  function getSeason(month) {
Â  Â  return SEASON_MAP.find(season => season.months.includes(month));
Â  }
Â  function updateSeasonUI(month) {
Â  Â  const season = getSeason(month);
Â  Â  document.body.style.background = season.bg;
Â  Â  document.getElementById('seasonImg').src = season.img;
Â  Â  document.getElementById('seasonText').textContent = `${season.name}ì˜ ì œì² `;
Â  Â  document.getElementById('seasonFoods').innerHTML =
Â  Â  Â  season.foods.map(f => `<span>${f}</span>`).join('');
Â  }

Â  // 2. ê°€ê³„ë¶€/ë‹¬ë ¥ ê¸°ë³¸
Â  const subCategories = {
Â  Â  'ì†Œë¹„': ['ì‹ë¹„', 'êµí†µë¹„', 'ê³ ì •ì§€ì¶œ', 'ê³µê³¼ê¸ˆ', 'ê±°ì£¼ë¹„ìš©', 'ë¬¸í™”ë¹„', 'ìê¸°ê°œë°œë¹„', 'ê¸°íƒ€(ì†Œë¹„)'],
Â  Â  'íˆ¬ì': ['ì ê¸ˆ', 'ë³´í—˜', 'ì£¼ì‹', 'ê°€ìƒí™”í', 'ìˆ˜ì§‘í’ˆ', 'ê¸°íƒ€(íˆ¬ì)'],
Â  Â  'ìˆ˜ì…': ['ì›”ê¸‰', 'ì´ììˆ˜ì…', 'ë°°ë‹¹ìˆ˜ì…', 'ê¸°íƒ€ìˆ˜ì…']
Â  };
Â  const today = new Date();
Â  let currentYear = today.getFullYear();
Â  let currentMonth = today.getMonth(); // 0-indexed
Â  let allData = {}; // {'YYYY-MM-DD': [{main,sub,amount,note}]}
Â  let initialAsset = 0;

Â  // ë‹¬ë ¥ ê·¸ë¦¬ê¸°
Â  function renderCalendar(year, month) {
Â  Â  updateSeasonUI(month+1);
Â  Â  const calendar = document.getElementById('calendar');
Â  Â  calendar.innerHTML = '';
Â  Â  document.getElementById('monthTitle').textContent = `${year}ë…„ ${month+1}ì›”`;
Â  Â  const weekDays = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
Â  Â  for(let d of weekDays) {
Â  Â  Â  let hd = document.createElement('div');
Â  Â  Â  hd.className = 'calendar-header';
Â  Â  Â  hd.textContent = d;
Â  Â  Â  calendar.appendChild(hd);
Â  Â  }
Â  Â  let firstDay = new Date(year, month, 1).getDay();
Â  Â  let lastDate = new Date(year, month+1, 0).getDate();
Â  Â  // ì• ë¹ˆì¹¸
Â  Â  for(let i=0; i<firstDay; i++) {
Â  Â  Â  let emp = document.createElement('div');
Â  Â  Â  emp.className = 'calendar-day empty';
Â  Â  Â  calendar.appendChild(emp);
Â  Â  }
Â  Â  for(let date=1; date<=lastDate; date++) {
Â  Â  Â  let day = new Date(year, month, date);
Â  Â  Â  let key = `${year}-${String(month+1).padStart(2,'0')}-${String(date).padStart(2,'0')}`;
Â  Â  Â  let hasData = allData[key] && allData[key].length>0;
Â  Â  Â  let cell = document.createElement('div');
Â  Â  Â  cell.className = 'calendar-day' +Â 
Â  Â  Â  Â  (today.getFullYear()===year&&today.getMonth()===month&&today.getDate()===date?' today':'') +
Â  Â  Â  Â  (hasData?' has-data':'');
Â  Â  Â  cell.textContent = date + (hasData?' â—':'');
Â  Â  Â  cell.onclick = () => showEntryBox(key, year, month, date);
Â  Â  Â  calendar.appendChild(cell);
Â  Â  }
Â  Â  updateMonthlySummary();
Â  Â  updateCharts();
Â  Â  updateAnnualSummary();
Â  }

Â  // ì…ë ¥ë°•ìŠ¤ show/hide ë° ë°ì´í„° ì±„ìš°ê¸°
Â  function showEntryBox(key, year, month, date) {
Â  Â  document.getElementById('entryBox').style.display = 'block';
Â  Â  document.getElementById('selectedDate').textContent = `${year}-${String(month+1).padStart(2,'0')}-${String(date).padStart(2,'0')} ë‚´ì—­`;
Â  Â  renderEntryTable(key);

    const form = document.getElementById('entryForm');
    // âœ¨âœ¨âœ¨ ìˆ˜ì •ëœ ë¶€ë¶„: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¤‘ë³µ ë“±ë¡ ë°©ì§€ âœ¨âœ¨âœ¨
    form.onsubmit = null; // ê¸°ì¡´ í•¸ë“¤ëŸ¬ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    
Â  Â  form.onsubmit = function(e){
Â  Â  Â  e.preventDefault();
Â  Â  Â  const main = document.getElementById('mainCategory').value;
Â  Â  Â  const sub = document.getElementById('subCategory').value;
Â  Â  Â  const amount = Number(document.getElementById('amount').value);
Â  Â  Â  const note = document.getElementById('note').value;
Â  Â  Â  if(!allData[key]) allData[key] = [];
Â  Â  Â  allData[key].push({main,sub,amount,note});
Â  Â  Â  renderEntryTable(key);
Â  Â  Â  renderCalendar(currentYear, currentMonth);
Â  Â  Â  this.reset();
Â  Â  Â  updateSubCategories();
Â  Â  };

Â  Â  document.getElementById('closeEntry').onclick = () => {
Â  Â  Â  document.getElementById('entryBox').style.display = 'none';
Â  Â  };
Â  Â  document.getElementById('mainCategory').onchange = updateSubCategories;
Â  Â  updateSubCategories();
Â  }
Â  function updateSubCategories() {
Â  Â  const main = document.getElementById('mainCategory').value;
Â  Â  const subSel = document.getElementById('subCategory');
Â  Â  subSel.innerHTML = '';
Â  Â  for(let sub of subCategories[main]) {
Â  Â  Â  let opt = document.createElement('option');
Â  Â  Â  opt.value = sub; opt.textContent = sub;
Â  Â  Â  subSel.appendChild(opt);
Â  Â  }
Â  }
Â  function renderEntryTable(key) {
Â  Â  const table = document.getElementById('dataTable');
Â  Â  table.innerHTML = '';
Â  Â  (allData[key]||[]).forEach((item, idx)=>{
Â  Â  Â  let tr = document.createElement('tr');
Â  Â  Â  tr.innerHTML = `<td>${item.main}</td><td>${item.sub}</td><td>${item.amount}</td><td>${item.note}</td>
Â  Â  Â  <td><button onclick="deleteEntry('${key}',${idx})">ì‚­ì œ</button></td>`;
Â  Â  Â  table.appendChild(tr);
Â  Â  });
Â  }
Â  window.deleteEntry = function(key, idx){
Â  Â  if(allData[key]) {
Â  Â  Â  allData[key].splice(idx,1);
Â  Â  Â  renderEntryTable(key);
Â  Â  Â  renderCalendar(currentYear, currentMonth);
Â  Â  }
Â  }
Â  document.getElementById('prevMonth').onclick = () => {
Â  Â  currentMonth--;
Â  Â  if(currentMonth<0) { currentMonth=11; currentYear--; }
Â  Â  renderCalendar(currentYear, currentMonth);
Â  Â  document.getElementById('entryBox').style.display = 'none';
Â  };
Â  document.getElementById('nextMonth').onclick = () => {
Â  Â  currentMonth++;
Â  Â  if(currentMonth>11) { currentMonth=0; currentYear++; }
Â  Â  renderCalendar(currentYear, currentMonth);
Â  Â  document.getElementById('entryBox').style.display = 'none';
Â  };

Â  // ì›”ë³„ ì§‘ê³„ (ì†Œë¹„/íˆ¬ì/ìˆ˜ì…/ì‰ì—¬ê¸ˆ)
Â  function updateMonthlySummary() {
Â  Â  let summary = {};
Â  Â  Object.entries(allData).forEach(([date, arr])=>{
Â  Â  Â  const month = date.slice(0,7);
Â  Â  Â  if (!summary[month]) summary[month] = { ì†Œë¹„:0, íˆ¬ì:0, ìˆ˜ì…:0 };
Â  Â  Â  arr.forEach(item=>{
Â  Â  Â  Â  summary[month][item.main] += Number(item.amount);
Â  Â  Â  });
Â  Â  });
Â  Â  let html = `<table class="summary-table"><tr>
Â  Â  Â  <th>ì›”</th>
Â  Â  Â  <th>ì†Œë¹„</th>
Â  Â  Â  <th>íˆ¬ì</th>
Â  Â  Â  <th>ìˆ˜ì…</th>
Â  Â  Â  <th>ì‰ì—¬ê¸ˆ</th>
Â  Â  </tr>`;
Â  Â  Object.keys(summary).sort().forEach(month=>{
Â  Â  Â  let ì†Œë¹„ = summary[month]['ì†Œë¹„']||0;
Â  Â  Â  let íˆ¬ì = summary[month]['íˆ¬ì']||0;
Â  Â  Â  let ìˆ˜ì… = summary[month]['ìˆ˜ì…']||0;
Â  Â  Â  let ì‰ì—¬ê¸ˆ = ìˆ˜ì… - (ì†Œë¹„ + íˆ¬ì);
Â  Â  Â  html += `<tr>
Â  Â  Â  Â  <td>${month}</td>
Â  Â  Â  Â  <td>${ì†Œë¹„}</td>
Â  Â  Â  Â  <td>${íˆ¬ì}</td>
Â  Â  Â  Â  <td>${ìˆ˜ì…}</td>
Â  Â  Â  Â  <td>${ì‰ì—¬ê¸ˆ}</td>
Â  Â  Â  </tr>`;
Â  Â  });
Â  Â  html += `</table>`;
Â  Â  document.getElementById('monthlySummary').innerHTML = html;
Â  }
Â  function updateCharts() {
Â  Â  const chartDiv = document.getElementById('charts');
Â  Â  chartDiv.innerHTML = '';
Â  Â  const summary = {};
Â  Â  Object.entries(allData).forEach(([date, arr])=>{
Â  Â  Â  const month = date.slice(0,7);
Â  Â  Â  if (!summary[month]) summary[month] = { ì†Œë¹„:0, íˆ¬ì:0, ìˆ˜ì…:0 };
Â  Â  Â  arr.forEach(item=>{
Â  Â  Â  Â  summary[month][item.main] += Number(item.amount);
Â  Â  Â  });
Â  Â  });
Â  Â  Object.keys(summary).sort().forEach(month=>{
Â  Â  Â  const data = [
Â  Â  Â  Â  summary[month]['ì†Œë¹„'],
Â  Â  Â  Â  summary[month]['íˆ¬ì'],
Â  Â  Â  Â  summary[month]['ìˆ˜ì…'],
Â  Â  Â  ];
Â  Â  Â  const colors = ['#ffb300','#82b1ff','#43a047'];
Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  canvas.id = 'chart-'+month;
Â  Â  Â  canvas.width = 300; canvas.height = 300;
Â  Â  Â  chartDiv.appendChild(Object.assign(document.createElement('div'),{className:'chart-area',innerHTML:`<h4>${month} ì†Œë¹„/íˆ¬ì/ìˆ˜ì… ë¹„ìœ¨</h4>`}));
Â  Â  Â  chartDiv.lastChild.appendChild(canvas);
Â  Â  Â  new Chart(canvas.getContext('2d'),{
Â  Â  Â  Â  type:'pie',
Â  Â  Â  Â  data:{
Â  Â  Â  Â  Â  labels:['ì†Œë¹„','íˆ¬ì','ìˆ˜ì…'],
Â  Â  Â  Â  Â  datasets:[{
Â  Â  Â  Â  Â  Â  data:data,
Â  Â  Â  Â  Â  Â  backgroundColor: colors
Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  },
Â  Â  Â  Â  options:{
Â  Â  Â  Â  Â  plugins:{ legend:{position:'bottom'} }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  });
Â  }
Â  function updateAnnualSummary() {
Â  Â  let yearly = {};
Â  Â  Object.entries(allData).forEach(([date, arr])=>{
Â  Â  Â  const [y] = date.split('-');
Â  Â  Â  if (!yearly[y]) yearly[y]={ì†Œë¹„:0,íˆ¬ì:0,ìˆ˜ì…:0};
Â  Â  Â  arr.forEach(item=>{
Â  Â  Â  Â  yearly[y][item.main] += Number(item.amount);
Â  Â  Â  });
Â  Â  });
Â  Â  let years = Object.keys(yearly).sort();
Â  Â  let assetArr = [];
Â  Â  let yearSum = {};
Â  Â  let prev = initialAsset;
Â  Â  let html = "";
Â  Â  years.forEach(y=>{
Â  Â  Â  let ì†Œë¹„ = yearly[y].ì†Œë¹„||0, íˆ¬ì=yearly[y].íˆ¬ì||0, ìˆ˜ì…=yearly[y].ìˆ˜ì…||0;
Â  Â  Â  let sum = ìˆ˜ì… - (ì†Œë¹„ + íˆ¬ì);
Â  Â  Â  yearSum[y] = sum;
Â  Â  Â  prev += sum;
Â  Â  Â  assetArr.push(prev);
Â  Â  });
Â  Â  if (years.length === 0) {
Â  Â  Â  document.getElementById('annualSummary').innerHTML = "";
Â  Â  Â  return;
Â  Â  }
Â  Â  html += `<h3>ğŸ“ˆ ì—°ë§ ìì‚°ë³€ë™</h3>`;
Â  Â  html += `<table class="summary-table"><tr>
Â  Â  Â  <th>ì—°ë„</th><th>ìì‚°ì¦ê°(â‚©)</th><th>ëˆ„ì ìì‚°(â‚©)</th></tr>`;
Â  Â  prev = initialAsset;
Â  Â  years.forEach((y,i)=>{
Â  Â  Â  let sum = yearSum[y];
Â  Â  Â  prev += sum;
Â  Â  Â  html += `<tr>
Â  Â  Â  Â  <td>${y}</td>
Â  Â  Â  Â  <td>${sum>=0?"+":""}${sum}</td>
Â  Â  Â  Â  <td>${prev}</td>
Â  Â  Â  </tr>`;
Â  Â  });
Â  Â  html += `</table>`;
Â  Â  html += `<canvas id="assetChart" width="400" height="260"></canvas>`;
Â  Â  document.getElementById('annualSummary').innerHTML = html;
Â  Â  const ctx = document.getElementById('assetChart').getContext('2d');
Â  Â  new Chart(ctx, {
Â  Â  Â  type: 'line',
Â  Â  Â  data: {
Â  Â  Â  Â  labels: years,
Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  label: 'ëˆ„ì ìì‚°(â‚©)',
Â  Â  Â  Â  Â  data: assetArr,
Â  Â  Â  Â  Â  fill: false,
Â  Â  Â  Â  Â  borderColor: '#42a5f5',
Â  Â  Â  Â  Â  tension: 0.1
Â  Â  Â  Â  }]
Â  Â  Â  },
Â  Â  Â  options: { plugins: { legend: { display: false } } }
Â  Â  });
Â  Â  // ë©”ì‹œì§€
Â  Â  if (years.length > 1) {
Â  Â  Â  let last = assetArr[assetArr.length-1], prevY = assetArr[assetArr.length-2];
Â  Â  Â  let pct = prevY===0 ? 0 : ((last-prevY)/Math.abs(prevY)*100).toFixed(1);
Â  Â  Â  html += `<p><b>ì—°ë§ ë©”ì‹œì§€:</b> ì˜¬í•´ ìì‚°ì€ ì‘ë…„ ëŒ€ë¹„ <b>${pct}% ${last-prevY>=0?'ì¦ê°€':'ê°ì†Œ'}</b>í–ˆìŠµë‹ˆë‹¤.</p>`;
Â  Â  Â  document.getElementById('annualSummary').innerHTML = html;
Â  Â  }
Â  }
Â  // ì´ˆê¸°í™”
Â  renderCalendar(currentYear, currentMonth);
</script>
