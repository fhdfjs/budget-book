<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‚˜ì˜ ê°€ê³„ë¶€</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body { font-family: sans-serif; transition: background 0.5s; }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    .header { text-align: center; margin-bottom: 20px; }
    .season-info { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 20px; }
    .season-info img { width: 50px; height: 50px; }
    #seasonFoods span { background-color: rgba(255,255,255,0.6); padding: 5px 10px; border-radius: 15px; margin: 0 4px; font-size: 0.9em; }
    .calendar-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
    .calendar-header, .calendar-day { padding: 10px; text-align: center; border-radius: 5px; }
    .calendar-header { background-color: #f0f0f0; font-weight: bold; }
    .calendar-day { background-color: #fff; cursor: pointer; }
    .calendar-day.empty { background-color: transparent; cursor: default; }
    .calendar-day:hover { background-color: #e0e0e0; }
    .calendar-day.today { border: 2px solid #42a5f5; font-weight: bold; }
    .calendar-day.has-data { color: #d32f2f; }
    #entryBox { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 100; width: 90%; max-width: 500px; }
    #entryForm { display: flex; flex-direction: column; gap: 10px; }
    .summary-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .summary-table th, .summary-table td { border: 1px solid #ddd; padding: 8px; text-align: right; }
    .summary-table th { background-color: #f2f2f2; text-align: center; }
    .charts-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-top: 20px; }
    .chart-area { text-align: center; }
  </style>
</head>
<body>

  <div class="container">
    <header class="header">
      <div class="season-info">
        <img id="seasonImg" src="" alt="season-icon">
        <div>
          <h2 id="seasonText"></h2>
          <div id="seasonFoods"></div>
        </div>
      </div>
      <div class="calendar-controls">
        <button id="prevMonth">â—€ ì´ì „ ë‹¬</button>
        <h1 id="monthTitle"></h1>
        <button id="nextMonth">ë‹¤ìŒ ë‹¬ â–¶</button>
      </div>
    </header>
    
    <main>
      <div id="calendar"></div>
      <hr style="margin: 30px 0;">
      <div id="monthlySummary"></div>
      <hr style="margin: 30px 0;">
      <div id="annualSummary"></div>
      <hr style="margin: 30px 0;">
      <div class="charts-container" id="charts"></div>
    </main>
  </div>

  <div id="entryBox">
    <h3 id="selectedDate"></h3>
    <form id="entryForm">
      <select id="mainCategory">
        <option value="ì†Œë¹„">ì†Œë¹„</option>
        <option value="íˆ¬ì">íˆ¬ì</option>
        <option value="ìˆ˜ì…">ìˆ˜ì…</option>
      </select>
      <select id="subCategory"></select>
      <input type="number" id="amount" placeholder="ê¸ˆì•¡" required>
      <input type="text" id="note" placeholder="ë©”ëª¨">
      <button type="submit">ì €ì¥</button>
    </form>
    <table class="summary-table" style="margin-top: 20px;">
      <thead>
        <tr><th>ëŒ€ë¶„ë¥˜</th><th>ì†Œë¶„ë¥˜</th><th>ê¸ˆì•¡</th><th>ë©”ëª¨</th><th>ì‚­ì œ</th></tr>
      </thead>
      <tbody id="dataTable"></tbody>
    </table>
    <button id="closeEntry" style="margin-top: 15px;">ë‹«ê¸°</button>
  </div>

  <script>
    // 1. ê³„ì ˆ/ì œì²  ì‹í’ˆ/ì´ë¯¸ì§€/íŒŒìŠ¤í…”í†¤
    const SEASON_MAP = [
      {
        name: "ë´„", months: [3,4,5], bg: "#ffeef7",
        img: "https://openmoji.org/data/color/svg/1F353.svg", 
        foods: ["ë”¸ê¸°ğŸ“", "ë‘ë¦…", "ì‘¥", "ë‹¬ë˜", "ë¯¸ë‚˜ë¦¬"]
      },
      {
        name: "ì—¬ë¦„", months: [6,7,8], bg: "#e3faff",
        img: "https://openmoji.org/data/color/svg/1F349.svg",
        foods: ["ìˆ˜ë°•ğŸ‰", "ì°¸ì™¸", "ì˜¥ìˆ˜ìˆ˜ğŸŒ½", "ì˜¤ì´ğŸ¥’"]
      },
      {
        name: "ê°€ì„", months: [9,10,11], bg: "#fff7e3",
        img: "https://openmoji.org/data/color/svg/1F34E.svg",
        foods: ["ë°¤ğŸŒ°", "ê°", "ì‚¬ê³¼ğŸ", "ê³ êµ¬ë§ˆ", "ë²„ì„¯"]
      },
      {
        name: "ê²¨ìš¸", months: [12,1,2], bg: "#eaf3ff",
        img: "https://openmoji.org/data/color/svg/1F34A.svg",
        foods: ["ê·¤ğŸŠ", "ë°°ì¶”", "ë¬´", "ëŒ€íŒŒ", "ë°©ì–´ğŸŸ"]
      }
    ];
    function getSeason(month) {
      return SEASON_MAP.find(season => season.months.includes(month));
    }
    function updateSeasonUI(month) {
      const season = getSeason(month);
      document.body.style.background = season.bg;
      document.getElementById('seasonImg').src = season.img;
      document.getElementById('seasonText').textContent = `${season.name}ì˜ ì œì² `;
      document.getElementById('seasonFoods').innerHTML =
        season.foods.map(f => `<span>${f}</span>`).join('');
    }

    // 2. ê°€ê³„ë¶€/ë‹¬ë ¥ ê¸°ë³¸
    const subCategories = {
      'ì†Œë¹„': ['ì‹ë¹„', 'êµí†µë¹„', 'ê³ ì •ì§€ì¶œ', 'ê³µê³¼ê¸ˆ', 'ê±°ì£¼ë¹„ìš©', 'ë¬¸í™”ë¹„', 'ìê¸°ê°œë°œë¹„', 'ê¸°íƒ€(ì†Œë¹„)'],
      'íˆ¬ì': ['ì ê¸ˆ', 'ë³´í—˜', 'ì£¼ì‹', 'ê°€ìƒí™”í', 'ìˆ˜ì§‘í’ˆ', 'ê¸°íƒ€(íˆ¬ì)'],
      'ìˆ˜ì…': ['ì›”ê¸‰', 'ì´ììˆ˜ì…', 'ë°°ë‹¹ìˆ˜ì…', 'ê¸°íƒ€ìˆ˜ì…']
    };
    const today = new Date();
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth(); // 0-indexed
    let allData = {}; // {'YYYY-MM-DD': [{main,sub,amount,note}]}
    let initialAsset = 0;

    function renderCalendar(year, month) {
      updateSeasonUI(month+1);
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';
      document.getElementById('monthTitle').textContent = `${year}ë…„ ${month+1}ì›”`;
      const weekDays = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
      for(let d of weekDays) {
        let hd = document.createElement('div');
        hd.className = 'calendar-header';
        hd.textContent = d;
        calendar.appendChild(hd);
      }
      let firstDay = new Date(year, month, 1).getDay();
      let lastDate = new Date(year, month+
